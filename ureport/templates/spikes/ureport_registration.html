{% extends "ureport_layout.html" %}

{% block javascripts %}
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script src="http://openlayers.org/api/2.11-rc1/OpenLayers.js?1123"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}generic/javascripts/map.js"></script>
    <link rel="stylesheet" href="//cdn.oesmith.co.uk/morris-0.4.1.min.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <script src="//cdn.oesmith.co.uk/morris-0.4.1.min.js"></script>

    {{ block.super }}
{% endblock %}
{% block top_js %}
    <script language="javascript">
        $(document).ready(function () {
            $('#plot_btn').click(function () {
                var start_date = $('#start_date').val();
                var end_date = $('#end_date').val();
                $('#myfirstchart').html('');
                $.ajax({
                    dataType: "json",
                    url: "http://127.0.0.1:8000/mjspike",
                    data: {'start_date': start_date, 'end_date': end_date},
                    success: function (data) {
                        new Morris.Line({
                            element: 'myfirstchart',
                            data: data,
                            xkey: 'date',
                            ykeys: ['count'],
                            labels: ['Number of Registrations']
                        });
                    }
                });
            });
            $("select#missing").change(function () {
                var value = $(this).val();
                $('#pie').html('');
                $.ajax({
                    dataType: "json",
                    url: "http://127.0.0.1:8000/mjspike_missing",
                    data: {'field': value},
                    success: function (data) {
                        Morris.Donut({
                            element: 'pie',
                            data: [
                                {label: "URpeort Contacts Missing " + value, value: data.percentage},
                                {label: "URpeort Contacts with " + value, value: 100 - data.percentage}

                            ]
                        });
                    }
                });
            }).change();


        });
    </script>
{% endblock %}
{% block content %}
    <div class="select dates">
        <input type="text" name="start_date" id="start_date" placeholder="Start Date"/>
        <input type="text" name="end_date" id="end_date" placeholder="End Date"/>
        <a id="plot_btn" href="#">Plot</a>
    </div>
    <div id="myfirstchart" style="height: 400px;">
    </div>
    <select name="missing_field" id="missing">
        <option value="gender">Gender</option>
        <option value="age">Age</option>
        <option value="district">District</option>
        <option value="village">Village</option>
    </select>
    <div id="pie" style="height: 400px;">
    </div>



{% endblock %}